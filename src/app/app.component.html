<mat-toolbar class="bg-blue-500 text-white shadow-md py-4 flex items-center">
  <div class="flex-grow text-center">
    <span class="block text-3xl font-bold">Form Builder</span>
  </div>
  <button mat-raised-button color="accent" (click)="exportCode()">
    <mat-icon>download</mat-icon> Export Form
  </button>
</mat-toolbar>

<!-- Main container with a fixed height and flexbox layout -->
<div class="h-[calc(100vh-96px)] p-4 bg-gray-100 flex gap-4">

  <!-- Left Panel: Form Elements Palette -->
  <div class="w-64 p-4 bg-white rounded-lg shadow-lg flex flex-col">
    <h3 class="text-lg font-semibold mb-4">Form Elements</h3>
    <div *ngIf="formCanvasComponent"
         cdkDropList #formElementsPalette="cdkDropList"
         [id]="'formElementsPalette'"
         [cdkDropListData]="formElements"
         [cdkDropListConnectedTo]="formCanvasComponent.dropListContainers"
         [cdkDropListEnterPredicate]="noReturnPredicate"
         class="flex-grow space-y-2 overflow-y-auto">
      <div *ngFor="let element of formElements" cdkDrag
           class="p-3 bg-gray-100 rounded-lg shadow-sm flex items-center space-x-2 cursor-grab">
        <mat-icon [svgIcon]="getIcon(element.type)"></mat-icon>
        <span>{{ element.label }}</span>
        <div *cdkDragPreview class="p-3 bg-blue-500 text-white rounded-lg shadow-md flex items-center space-x-2">
          <mat-icon [svgIcon]="getIcon(element.type)"></mat-icon>
          <span>{{ element.label }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Center Panel: Form Canvas -->
  <div class="flex-grow p-4 bg-white rounded-lg shadow-lg h-full flex flex-col">
    <app-form-canvas [formConfig]="formConfig"
                     [formElementsPalette]="formElements"
                     [selectedElement]="selectedElement"
                     (selectElementEvent)="selectedElement = $event"
                     (formConfigChanged)="formConfig = $event">
    </app-form-canvas>
  </div>

  <!-- Right Panel: Properties Panel -->
  <div class="w-80 p-4 bg-white rounded-lg shadow-lg h-full flex flex-col">
    <h3 class="text-lg font-semibold mb-4">Properties</h3>
    <div class="flex-grow overflow-y-auto">
      <div *ngIf="selectedElement" class="space-y-4 mt-2">
        <!-- Common Properties -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Label</mat-label>
          <input matInput [(ngModel)]="selectedElement.label" (ngModelChange)="onElementPropertyChanged()">
        </mat-form-field>
        
        <!-- Placeholder Property (Text, Textarea) -->
        <mat-form-field *ngIf="selectedElement.type === 'text' || selectedElement.type === 'textarea'" appearance="outline" class="w-full">
          <mat-label>Placeholder</mat-label>
          <input matInput [(ngModel)]="selectedElement.placeholder" (ngModelChange)="onElementPropertyChanged()">
        </mat-form-field>

        <!-- Input Type Dropdown (Text Field) -->
        <mat-form-field *ngIf="selectedElement.type === 'text'" appearance="outline" class="w-full">
          <mat-label>Input Type</mat-label>
          <mat-select [(ngModel)]="selectedElement.type" (ngModelChange)="onElementPropertyChanged()">
            <mat-option value="text">Text</mat-option>
            <mat-option value="email">Email</mat-option>
            <mat-option value="password">Password</mat-option>
            <mat-option value="number">Number</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Required Checkbox -->
        <mat-checkbox [(ngModel)]="selectedElement.required" (ngModelChange)="onElementPropertyChanged()">
          Required Field
        </mat-checkbox>
        
        <!-- Options for Dropdown and Radio Group -->
        <div *ngIf="selectedElement.type === 'dropdown' || selectedElement.type === 'radio'" class="space-y-2">
          <h4 class="text-md font-semibold">Options</h4>
          <div *ngFor="let option of selectedElement.options; let i = index" class="flex gap-2 items-center">
            <mat-form-field appearance="outline" class="flex-grow">
              <mat-label>Label</mat-label>
              <input matInput [(ngModel)]="option.label" (ngModelChange)="onElementPropertyChanged()">
            </mat-form-field>
            <button mat-icon-button color="warn" (click)="removeOption(i)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <button mat-flat-button color="primary" (click)="addOption()">
            <mat-icon>add</mat-icon> Add Option
          </button>
        </div>
      </div>
      <div *ngIf="!selectedElement" class="flex flex-col items-center justify-center h-full text-gray-500">
        Select a field to customize
      </div>
    </div>
  </div>
</div>
